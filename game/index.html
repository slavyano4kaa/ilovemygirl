<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–æ—Ä—Ç–∏–∫–∏ –¥–ª—è –ª—é–±–∏–º–æ–π üíó</title>
    <style>
        * {
            box-sizing: border-box;
            user-select: none;
            font-family: 'Segoe UI', Roboto, system-ui, sans-serif;
        }

        body {
            min-height: 100vh;
            margin: 0;
            background-image: url('background.png');
            background-size: cover;
            background-position: center;
            display: flex;
            flex-direction: column;
            transition: filter 0.3s, background 0.3s;
        }

        /* –ü—Ä–µ–ª–æ–∞–¥–µ—Ä */
        .preloader {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
            z-index: 10000;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: opacity 0.5s ease;
        }

        .preloader.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .preloader-content {
            text-align: center;
            width: 400px;
        }

        .preloader-title {
            color: #ffecb3;
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 2rem;
            text-shadow: 3px 3px 0 #000;
        }

        .preloader-bar-bg {
            width: 100%;
            height: 30px;
            background: rgba(0, 0, 0, 0.6);
            border-radius: 30px;
            overflow: hidden;
            border: 3px solid #dbb47a;
            margin-bottom: 1rem;
        }

        .preloader-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #f1c40f, #f39c12);
            width: 0%;
            transition: width 0.2s ease;
            border-radius: 30px;
            box-shadow: 0 0 20px #f1c40f;
        }

        .preloader-text {
            color: white;
            font-size: 1.2rem;
            text-shadow: 2px 2px 0 #000;
        }

        .preloader-percent {
            color: #f1c40f;
            font-weight: bold;
            font-size: 1.5rem;
        }

        /* –û—Å—Ç–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ —Ç–∞–∫–∏–µ –∂–µ –∫–∞–∫ –≤ —Ä–∞–±–æ—á–µ–π –≤–µ—Ä—Å–∏–∏ */
        body.game-over {
            filter: brightness(0.7) sepia(0.3);
            position: relative;
        }

        body.game-over::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 0, 0, 0.3);
            pointer-events: none;
            z-index: 100;
            animation: vignette 1s ease;
        }

        @keyframes vignette {
            0% { opacity: 0; }
            100% { opacity: 1; }
        }

        /* –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å */
        .top-bar {
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(10px);
            border-bottom: 3px solid #dbb47a;
            padding: 0.8rem 2rem;
            box-shadow: 0 10px 20px rgba(0,0,0,0.5);
            position: relative;
            z-index: 10;
        }

        .balance-container {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: rgba(0, 0, 0, 0.4);
            padding: 0.5rem 1.2rem;
            border-radius: 40px;
            border: 2px solid #ffecb3;
            box-shadow: 0 4px 0 #5a6263;
            cursor: pointer;
            transition: all 0.2s;
        }

        .balance-container:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 0 #5a6263;
        }

        .balance-container.active {
            transform: translateY(2px);
            box-shadow: 0 2px 0 #5a6263;
        }

        .coin-icon {
            width: 40px;
            height: 40px;
            background-image: url('coin.png');
            background-size: contain;
            background-position: center;
            background-repeat: no-repeat;
            filter: drop-shadow(0 2px 2px rgba(0,0,0,0.5));
        }

        .balance-amount {
            font-size: 2rem;
            font-weight: bold;
            color: #ffecb3;
            text-shadow: 2px 2px 0 #000, 0 0 10px #f1c40f;
        }

        .stats-dropdown {
            position: absolute;
            top: 100%;
            left: 2rem;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
            border: 3px solid #dbb47a;
            border-radius: 20px;
            padding: 1.5rem;
            margin-top: 0.5rem;
            min-width: 400px;
            z-index: 1000;
            display: none;
            box-shadow: 0 10px 30px rgba(0,0,0,0.8);
        }

        .stats-dropdown.show {
            display: block;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .stats-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            color: #ffecb3;
            font-size: 1.5rem;
            font-weight: bold;
            text-shadow: 2px 2px 0 #000;
        }

        .close-stats {
            font-size: 2rem;
            cursor: pointer;
            line-height: 1;
            padding: 0 0.5rem;
        }

        .close-stats:hover {
            color: #e74c3c;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
        }

        .stat-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 1rem;
            border-radius: 15px;
            text-align: center;
            border: 1px solid #dbb47a;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: #f1c40f;
            text-shadow: 2px 2px 0 #000;
            line-height: 1.2;
        }

        .stat-label {
            color: white;
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .profile-selector {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
            justify-content: center;
        }

        .profile-btn {
            padding: 0.5rem 1rem;
            font-size: 1rem;
            font-weight: bold;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            background: #7f8c8d;
            color: white;
            transition: all 0.1s;
            flex: 1;
        }

        .profile-btn.active {
            background: #3498db;
            transform: scale(0.95);
        }

        .save-buttons {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .save-btn {
            flex: 1;
            padding: 0.5rem;
            font-size: 0.9rem;
            font-weight: bold;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            color: white;
            transition: all 0.1s;
        }

        .save-btn.save { background: #2ecc71; }
        .save-btn.export { background: #f39c12; }
        .save-btn.import { background: #9b59b6; }
        .save-btn:active { transform: scale(0.95); }

        .timer-center {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 200px;
        }

        .timer-display {
            font-size: 3rem;
            font-weight: bold;
            color: white;
            text-shadow: 3px 3px 0 #000, 0 0 20px rgba(255,255,255,0.5);
            line-height: 1;
            margin-bottom: 5px;
        }

        .timer-bar-container {
            width: 100%;
            height: 12px;
            background: rgba(0, 0, 0, 0.6);
            border-radius: 20px;
            overflow: hidden;
            border: 2px solid #dbb47a;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.5);
        }

        .timer-bar-fill {
            height: 100%;
            width: 100%;
            transition: width 0.1s linear, background-color 0.3s ease;
            border-radius: 20px;
            box-shadow: 0 0 10px currentColor;
        }

        .right-panel {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .mode-selector {
            display: flex;
            gap: 0.3rem;
            background: rgba(0,0,0,0.3);
            padding: 0.4rem;
            border-radius: 40px;
        }

        .mode-btn {
            padding: 0.6rem 1.2rem;
            font-size: 1rem;
            font-weight: bold;
            border: none;
            border-radius: 35px;
            cursor: pointer;
            transition: all 0.1s;
            color: white;
            background: #7f8c8d;
            box-shadow: 0 3px 0 #5a6263;
        }

        .mode-btn.active {
            background: #3498db;
            box-shadow: 0 3px 0 #2980b9;
            transform: translateY(-2px);
        }

        .difficulty-selector {
            display: flex;
            gap: 0.2rem;
            background: rgba(0,0,0,0.3);
            padding: 0.4rem;
            border-radius: 40px;
        }

        .difficulty-btn {
            padding: 0.6rem 1rem;
            font-size: 0.9rem;
            font-weight: bold;
            border: none;
            border-radius: 35px;
            cursor: pointer;
            transition: all 0.1s;
            color: white;
            box-shadow: 0 3px 0 rgba(0,0,0,0.3);
        }

        .difficulty-btn.easy { background: #3498db; }
        .difficulty-btn.medium { background: #f39c12; }
        .difficulty-btn.hard { background: #e74c3c; }
        .difficulty-btn.active { transform: scale(0.95); box-shadow: inset 0 2px 5px rgba(0,0,0,0.3); }

        .refresh-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: rgba(0,0,0,0.3);
            padding: 0.2rem 0.8rem;
            border-radius: 30px;
            border: 2px solid #dbb47a;
        }

        .refresh-btn {
            font-size: 1.8rem;
            cursor: pointer;
            filter: drop-shadow(0 3px 0 #5a6263);
            transition: all 0.1s;
        }

        .refresh-btn:active {
            transform: translateY(3px);
            filter: drop-shadow(0 0 0 #5a6263);
        }

        .refresh-count {
            color: white;
            font-size: 0.9rem;
            font-weight: bold;
            text-shadow: 1px 1px 0 #000;
            margin-top: -5px;
        }

        .progress-wrapper {
            width: 100%;
            max-width: 800px;
            margin: 1rem auto;
            position: relative;
            padding: 2rem 0 1rem;
        }

        .goal-container {
            width: 100%;
            position: relative;
        }

        .goal-header {
            display: flex;
            justify-content: space-between;
            color: white;
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
            text-shadow: 2px 2px 0 #000;
        }

        .goal-header span:first-child {
            color: #f1c40f;
        }

        .goal-bar-bg {
            width: 100%;
            height: 40px;
            background: rgba(0, 0, 0, 0.6);
            border-radius: 30px;
            overflow: hidden;
            border: 3px solid #ffecb3;
            position: relative;
        }

        .goal-bar-fill {
            height: 100%;
            background: #f1c40f;
            width: 0%;
            transition: width 0.3s ease;
            border-radius: 30px;
            box-shadow: 0 0 20px #f1c40f;
        }

        .goal-markers {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            display: flex;
            pointer-events: none;
        }

        .goal-marker {
            flex: 1;
            height: 100%;
            border-right: 2px solid rgba(255, 255, 255, 0.5);
        }

        .goal-marker:last-child {
            border-right: none;
        }

        .reward-bubbles {
            position: relative;
            width: 100%;
            height: 100px;
            margin-top: -20px;
        }

        .reward-bubble {
            position: absolute;
            top: 0;
            transform: translateX(-50%);
            display: flex;
            flex-direction: column;
            align-items: center;
            transition: all 0.3s ease;
        }

        .bubble-arrow {
            width: 0;
            height: 0;
            border-left: 15px solid transparent;
            border-right: 15px solid transparent;
            border-bottom: 20px solid #ffecb3;
            margin-bottom: 5px;
            filter: drop-shadow(0 4px 2px rgba(0,0,0,0.3));
        }

        .bubble-icon {
            width: 70px;
            height: 70px;
            background-size: contain;
            background-position: center;
            background-repeat: no-repeat;
            transition: all 0.3s ease;
            filter: drop-shadow(0 4px 4px rgba(0,0,0,0.5));
            position: relative;
        }

        .reward-bubble.collected .bubble-icon::after {
            content: '‚úì';
            position: absolute;
            top: -10px;
            right: -10px;
            width: 30px;
            height: 30px;
            background: #2ecc71;
            color: white;
            font-size: 1.5rem;
            font-weight: bold;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }

        .center-wrapper {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 1rem;
        }

        .board {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 1rem;
            max-width: 1100px;
        }

        .plank {
            width: 240px;
            height: 95px;
            background-image: url('table.png');
            background-size: 100% 100%;
            background-repeat: no-repeat;
            position: relative;
            border: none;
            margin-bottom: 8px;
        }

        .cakes-area {
            position: absolute;
            top: 0px;
            left: 50%;
            transform: translateX(-50%);
            width: 210px;
            height: 70px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
        }

        .cake {
            width: 70px;
            height: 70px;
            background-size: contain;
            background-position: center;
            background-repeat: no-repeat;
            cursor: grab;
            background-color: transparent;
            border: none;
            outline: none;
            transition: transform 0.2s ease, opacity 0.2s ease;
        }

        .cake:active {
            cursor: grabbing;
            transform: scale(0.95);
        }

        .cake.dragging { opacity: 0.7; }
        .cake.matched { animation: flyAway 0.5s ease forwards; }

        @keyframes flyAway {
            0% { transform: translateY(0) scale(1); opacity: 1; }
            50% { transform: translateY(-50px) scale(1.2); opacity: 0.8; }
            100% { transform: translateY(-200px) scale(0.5); opacity: 0; }
        }

        .cake[data-flavor="0"] { background-image: url('cupcake1.png'); }
        .cake[data-flavor="1"] { background-image: url('cupcake2.png'); }
        .cake[data-flavor="2"] { background-image: url('cupcake3.png'); }
        .cake[data-flavor="3"] { background-image: url('cupcake4.png'); }
        .cake[data-flavor="4"] { background-image: url('cupcake5.png'); }

        .plate-wrapper {
            width: 200px;
            height: 80px;
            margin: 0 auto;
            background-image: url('plate.png');
            background-size: 100% 100%;
            background-repeat: no-repeat;
            position: relative;
            border: none;
        }

        .plate-area {
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 160px;
            height: 80px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 5px;
        }

        .future-cake {
            width: 45px;
            height: 45px;
            background-size: contain;
            background-position: center;
            background-repeat: no-repeat;
            background-color: transparent;
            border: none;
            outline: none;
        }

        .future-cake[data-flavor="0"] { background-image: url('cupcake1.png'); }
        .future-cake[data-flavor="1"] { background-image: url('cupcake2.png'); }
        .future-cake[data-flavor="2"] { background-image: url('cupcake3.png'); }
        .future-cake[data-flavor="3"] { background-image: url('cupcake4.png'); }
        .future-cake[data-flavor="4"] { background-image: url('cupcake5.png'); }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: linear-gradient(145deg, #2b4638, #1e3529);
            padding: 2rem;
            border-radius: 3rem;
            border: 4px solid #dbb47a;
            max-width: 500px;
            width: 90%;
        }

        .modal-content h3 {
            color: #ffecb3;
            font-size: 1.8rem;
            margin-bottom: 1rem;
            text-align: center;
        }

        .modal-content textarea {
            width: 100%;
            height: 150px;
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid #dbb47a;
            border-radius: 15px;
            color: white;
            padding: 1rem;
            font-size: 0.9rem;
            margin-bottom: 1rem;
            resize: vertical;
        }

        .modal-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
        }

        .modal-btn {
            padding: 0.6rem 1.5rem;
            font-size: 1rem;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            font-weight: bold;
        }

        .modal-btn.confirm {
            background: #2ecc71;
            color: white;
        }

        .modal-btn.cancel {
            background: #e74c3c;
            color: white;
        }

        .game-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(5px);
        }

        .game-overlay.show { display: flex; }

        .game-over-content {
            background: linear-gradient(145deg, #2b4638, #1e3529);
            padding: 2.5rem;
            border-radius: 4rem;
            text-align: center;
            border: 4px solid #dbb47a;
        }

        .game-over-content h2 {
            color: #ffecb3;
            font-size: 2.5rem;
            margin-bottom: 1.5rem;
            text-shadow: 2px 2px 0 #000;
        }

        .restart-btn {
            background: #e74c3c;
            color: white;
            font-size: 1.5rem;
            padding: 0.6rem 2rem;
            border: none;
            border-radius: 3rem;
            cursor: pointer;
            font-weight: bold;
            box-shadow: 0 4px 0 #c0392b;
            transition: 0.05s linear;
        }

        .restart-btn:active { transform: translateY(4px); box-shadow: none; }

        .victory-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(5px);
        }

        .victory-overlay.show { display: flex; }

        .victory-content {
            background: linear-gradient(145deg, #f1c40f, #f39c12);
            padding: 2.5rem;
            border-radius: 4rem;
            text-align: center;
            border: 4px solid #ffecb3;
        }

        .victory-content h2 {
            color: white;
            font-size: 2.5rem;
            margin-bottom: 1.5rem;
            text-shadow: 2px 2px 0 #000;
        }
    </style>
</head>
<body>
    <!-- –ü—Ä–µ–ª–æ–∞–¥–µ—Ä -->
    <div class="preloader" id="preloader">
        <div class="preloader-content">
            <div class="preloader-title">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
            <div class="preloader-bar-bg">
                <div class="preloader-bar-fill" id="preloaderBar" style="width: 0%;"></div>
            </div>
            <div class="preloader-text">
                <span id="preloaderFileName">–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ç–µ–∫—Å—Ç—É—Ä</span>
                <span class="preloader-percent" id="preloaderPercent">0%</span>
            </div>
        </div>
    </div>

    <!-- –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å -->
    <div class="top-bar">
        <div class="balance-container" id="balanceContainer">
            <div class="coin-icon"></div>
            <div class="balance-amount" id="balanceDisplay">0</div>
        </div>

        <div class="stats-dropdown" id="statsDropdown">
            <div class="stats-header">
                <span>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</span>
                <span class="close-stats" id="closeStats">√ó</span>
            </div>
            <div class="stats-grid">
                <div class="stat-item">
                    <div class="stat-value" id="totalMatches">0</div>
                    <div class="stat-label">–í—Å–µ–≥–æ –º—ç—Ç—á–µ–π</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="totalWins">0</div>
                    <div class="stat-label">–ü–æ–±–µ–¥</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="totalGames">0</div>
                    <div class="stat-label">–ò–≥—Ä —Å—ã–≥—Ä–∞–Ω–æ</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="bestScore">0</div>
                    <div class="stat-label">–†–µ–∫–æ—Ä–¥</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="totalCoins">0</div>
                    <div class="stat-label">–í—Å–µ–≥–æ –º–æ–Ω–µ—Ç</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="winPercent">0%</div>
                    <div class="stat-label">% –ø–æ–±–µ–¥</div>
                </div>
            </div>

            <div class="profile-selector">
                <button class="profile-btn active" data-profile="guest1">–ì–æ—Å—Ç—å 1</button>
                <button class="profile-btn" data-profile="guest2">–ì–æ—Å—Ç—å 2</button>
                <button class="profile-btn" data-profile="guest3">–ì–æ—Å—Ç—å 3</button>
            </div>

            <div class="save-buttons">
                <button class="save-btn save" id="saveGameBtn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                <button class="save-btn export" id="exportGameBtn">–≠–∫—Å–ø–æ—Ä—Ç</button>
                <button class="save-btn import" id="importGameBtn">–ò–º–ø–æ—Ä—Ç</button>
            </div>
        </div>

        <div class="timer-center">
            <div class="timer-display" id="timerDisplay">3:00</div>
            <div class="timer-bar-container">
                <div class="timer-bar-fill" id="timerBar" style="width: 100%; background-color: #2ecc71;"></div>
            </div>
        </div>

        <div class="right-panel">
            <div class="mode-selector">
                <button class="mode-btn active" data-mode="timed">3 –º–∏–Ω</button>
                <button class="mode-btn" data-mode="speed">Speed</button>
            </div>

            <div class="difficulty-selector">
                <button class="difficulty-btn easy active" data-difficulty="easy">Easy</button>
                <button class="difficulty-btn medium" data-difficulty="medium">Medium</button>
                <button class="difficulty-btn hard" data-difficulty="hard">Hard</button>
            </div>

            <div class="refresh-container">
                <div class="refresh-btn" id="refreshBtn">üîÑ</div>
                <div class="refresh-count" id="refreshCount">3/3</div>
            </div>
        </div>
    </div>

    <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä —Å –Ω–∞–≥—Ä–∞–¥–∞–º–∏ -->
    <div class="progress-wrapper">
        <div class="goal-container">
            <div class="goal-header">
                <span>–ú—ç—Ç—á–∏: <span id="matchesCount">0</span>/<span id="goalCount">20</span></span>
                <span>–ù–∞–≥—Ä–∞–¥—ã</span>
            </div>
            <div class="goal-bar-bg">
                <div class="goal-bar-fill" id="goalProgress" style="width: 0%;"></div>
                <div class="goal-markers">
                    <div class="goal-marker"></div>
                    <div class="goal-marker"></div>
                    <div class="goal-marker"></div>
                </div>
            </div>
        </div>

        <div class="reward-bubbles">
            <div class="reward-bubble" id="reward1" style="left: 33.33%;">
                <div class="bubble-arrow"></div>
                <div class="bubble-icon" style="background-image: url('100coins.png');"></div>
            </div>
            <div class="reward-bubble" id="reward2" style="left: 66.66%;">
                <div class="bubble-arrow"></div>
                <div class="bubble-icon" style="background-image: url('150coins.png');"></div>
            </div>
            <div class="reward-bubble" id="reward3" style="left: 100%;">
                <div class="bubble-arrow"></div>
                <div class="bubble-icon" style="background-image: url('200coins.png');"></div>
            </div>
        </div>
    </div>
    
    <div class="center-wrapper">
        <div class="board" id="board"></div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ -->
    <div class="modal" id="exportModal">
        <div class="modal-content">
            <h3>üì§ –≠–∫—Å–ø–æ—Ä—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è</h3>
            <textarea id="exportData" readonly></textarea>
            <div class="modal-buttons">
                <button class="modal-btn confirm" id="copyExportBtn">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
                <button class="modal-btn cancel" id="closeExportBtn">–ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
        </div>
    </div>

    <div class="modal" id="importModal">
        <div class="modal-content">
            <h3>üì• –ò–º–ø–æ—Ä—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è</h3>
            <textarea id="importData" placeholder="–í—Å—Ç–∞–≤—å—Ç–µ —Å—é–¥–∞ –∫–æ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è..."></textarea>
            <div class="modal-buttons">
                <button class="modal-btn confirm" id="confirmImportBtn">–ò–º–ø–æ—Ä—Ç</button>
                <button class="modal-btn cancel" id="closeImportBtn">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    </div>

    <div class="game-overlay" id="gameOverlay">
        <div class="game-over-content">
            <h2 id="gameOverTitle">üò¢ –¢—ã –ø—Ä–æ–∏–≥—Ä–∞–ª!</h2>
            <button class="restart-btn" id="restartFromOverlay">–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ</button>
        </div>
    </div>

    <div class="victory-overlay" id="victoryOverlay">
        <div class="victory-content">
            <h2>üéâ –ü–æ–±–µ–¥–∞!</h2>
            <button class="restart-btn" id="restartFromVictory">–ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞</button>
        </div>
    </div>

    <script>
        // ========== –ü–†–ï–õ–û–ê–î–ï–† –¢–ï–ö–°–¢–£–† ==========
        const textures = [
            'background.png',
            'table.png',
            'plate.png',
            'cupcake1.png',
            'cupcake2.png',
            'cupcake3.png',
            'cupcake4.png',
            'cupcake5.png',
            'coin.png',
            '100coins.png',
            '150coins.png',
            '200coins.png'
        ];

        let loadedCount = 0;
        const preloader = document.getElementById('preloader');
        const preloaderBar = document.getElementById('preloaderBar');
        const preloaderFileName = document.getElementById('preloaderFileName');
        const preloaderPercent = document.getElementById('preloaderPercent');

        function loadTextures() {
            textures.forEach((texture, index) => {
                const img = new Image();
                img.src = texture;
                img.onload = () => {
                    loadedCount++;
                    const percent = Math.round((loadedCount / textures.length) * 100);
                    preloaderBar.style.width = percent + '%';
                    preloaderFileName.textContent = texture;
                    preloaderPercent.textContent = percent + '%';
                    
                    if (loadedCount === textures.length) {
                        setTimeout(() => {
                            preloader.classList.add('hidden');
                            startGame(); // –ó–∞–ø—É—Å–∫–∞–µ–º –∏–≥—Ä—É –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏
                        }, 500);
                    }
                };
                img.onerror = () => {
                    // –ï—Å–ª–∏ —Ç–µ–∫—Å—Ç—É—Ä–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞, –≤—Å—ë —Ä–∞–≤–Ω–æ –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º
                    loadedCount++;
                    const percent = Math.round((loadedCount / textures.length) * 100);
                    preloaderBar.style.width = percent + '%';
                    preloaderPercent.textContent = percent + '%';
                    
                    if (loadedCount === textures.length) {
                        setTimeout(() => {
                            preloader.classList.add('hidden');
                            startGame();
                        }, 500);
                    }
                };
            });
        }

        // ========== –ò–ì–†–û–í–ê–Ø –õ–û–ì–ò–ö–ê ==========
        function startGame() {
            const MAX_CAKES = 3;
            const MAX_REFRESHES = 3;
            
            const difficultyConfig = {
                easy: { rows: 1, goalTimed: 20, goalSpeed: 20 },
                medium: { rows: 2, goalTimed: 30, goalSpeed: 30 },
                hard: { rows: 3, goalTimed: 40, goalSpeed: 40 }
            };

            const speedTimes = {
                easy: 10.0,
                medium: 7.5,
                hard: 5.0
            };

            let matches = 0;
            let goal = 20;
            let planks = [];
            let gameActive = false;
            let timerInterval = null;
            let currentTime = 180.0;
            let maxTime = 180.0;
            let currentMode = 'timed';
            let currentDifficulty = 'easy';
            let firstMatchMade = false;
            let refreshesLeft = MAX_REFRESHES;
            
            let playerStats = {
                totalMatches: 0,
                totalWins: 0,
                totalGames: 0,
                bestScore: 0,
                totalCoinsEarned: 0
            };
            
            let currentProfile = 'guest1';
            let balance = 0;
            let rewardsCollected = {
                reward1: false,
                reward2: false,
                reward3: false
            };

            let draggedElement = null;
            let sourcePlankIdx = null;
            let sourceCakeIdx = null;

            // –≠–ª–µ–º–µ–Ω—Ç—ã
            const body = document.body;
            const goalProgress = document.getElementById('goalProgress');
            const matchesCount = document.getElementById('matchesCount');
            const goalCount = document.getElementById('goalCount');
            const balanceDisplay = document.getElementById('balanceDisplay');
            const timerBar = document.getElementById('timerBar');
            const timerDisplay = document.getElementById('timerDisplay');
            const refreshCount = document.getElementById('refreshCount');
            const refreshBtn = document.getElementById('refreshBtn');
            const gameOverlay = document.getElementById('gameOverlay');
            const victoryOverlay = document.getElementById('victoryOverlay');
            const gameOverTitle = document.getElementById('gameOverTitle');
            
            const reward1 = document.getElementById('reward1');
            const reward2 = document.getElementById('reward2');
            const reward3 = document.getElementById('reward3');
            
            const totalMatchesEl = document.getElementById('totalMatches');
            const totalWinsEl = document.getElementById('totalWins');
            const totalGamesEl = document.getElementById('totalGames');
            const bestScoreEl = document.getElementById('bestScore');
            const totalCoinsEl = document.getElementById('totalCoins');
            const winPercentEl = document.getElementById('winPercent');
            
            const balanceContainer = document.getElementById('balanceContainer');
            const statsDropdown = document.getElementById('statsDropdown');
            const closeStats = document.getElementById('closeStats');
            
            const exportModal = document.getElementById('exportModal');
            const importModal = document.getElementById('importModal');
            const exportData = document.getElementById('exportData');
            const importData = document.getElementById('importData');

            // ========== UI –°–¢–ê–¢–ò–°–¢–ò–ö–ò ==========
            balanceContainer.addEventListener('click', () => {
                statsDropdown.classList.toggle('show');
                balanceContainer.classList.toggle('active');
            });

            closeStats.addEventListener('click', () => {
                statsDropdown.classList.remove('show');
                balanceContainer.classList.remove('active');
            });

            document.addEventListener('click', (e) => {
                if (!balanceContainer.contains(e.target) && !statsDropdown.contains(e.target)) {
                    statsDropdown.classList.remove('show');
                    balanceContainer.classList.remove('active');
                }
            });

            // ========== –°–ò–°–¢–ï–ú–ê –°–û–•–†–ê–ù–ï–ù–ò–ô ==========
            function loadFromStorage() {
                try {
                    const saved = localStorage.getItem(`cakeGame_${currentProfile}`);
                    if (saved) {
                        const data = JSON.parse(saved);
                        playerStats = data.playerStats || {
                            totalMatches: 0,
                            totalWins: 0,
                            totalGames: 0,
                            bestScore: 0,
                            totalCoinsEarned: 0
                        };
                        balance = data.balance || 0;
                        rewardsCollected = data.rewardsCollected || {
                            reward1: false,
                            reward2: false,
                            reward3: false
                        };
                        matches = data.matches || 0;
                        updateStats();
                        updateBalance();
                        updateRewardsUI();
                        updateCounter();
                    }
                } catch (e) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', e);
                }
            }
            
            function saveToStorage() {
                try {
                    const data = {
                        playerStats,
                        balance,
                        rewardsCollected,
                        matches,
                        version: '1.0'
                    };
                    localStorage.setItem(`cakeGame_${currentProfile}`, JSON.stringify(data));
                    updateStats();
                } catch (e) {
                    console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', e);
                }
            }
            
            function exportGame() {
                const data = {
                    playerStats,
                    balance,
                    rewardsCollected,
                    matches,
                    profile: currentProfile,
                    version: '1.0'
                };
                
                const json = JSON.stringify(data);
                const base64 = btoa(unescape(encodeURIComponent(json)));
                exportData.value = base64;
                exportModal.classList.add('show');
            }
            
            function importGame(code) {
                try {
                    const json = decodeURIComponent(escape(atob(code)));
                    const data = JSON.parse(json);
                    
                    if (data.version === '1.0') {
                        playerStats = data.playerStats || {
                            totalMatches: 0,
                            totalWins: 0,
                            totalGames: 0,
                            bestScore: 0,
                            totalCoinsEarned: 0
                        };
                        balance = data.balance || 0;
                        rewardsCollected = data.rewardsCollected || {
                            reward1: false,
                            reward2: false,
                            reward3: false
                        };
                        matches = data.matches || 0;
                        
                        saveToStorage();
                        updateStats();
                        updateBalance();
                        updateRewardsUI();
                        updateCounter();
                        importModal.classList.remove('show');
                    }
                } catch (e) {
                    console.error('–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞:', e);
                }
            }
            
            function updateStats() {
                totalMatchesEl.textContent = playerStats.totalMatches || 0;
                totalWinsEl.textContent = playerStats.totalWins || 0;
                totalGamesEl.textContent = playerStats.totalGames || 0;
                bestScoreEl.textContent = playerStats.bestScore || 0;
                totalCoinsEl.textContent = playerStats.totalCoinsEarned || 0;
                
                const winPercent = playerStats.totalGames > 0 
                    ? Math.round((playerStats.totalWins / playerStats.totalGames) * 100)
                    : 0;
                winPercentEl.textContent = winPercent + '%';
            }
            
            function updateRewardsUI() {
                if (rewardsCollected.reward1) reward1.classList.add('collected');
                if (rewardsCollected.reward2) reward2.classList.add('collected');
                if (rewardsCollected.reward3) reward3.classList.add('collected');
            }

            function updateBalance() {
                balanceDisplay.textContent = balance;
            }

            // ========== –ò–ì–†–û–í–ê–Ø –õ–û–ì–ò–ö–ê ==========
            function randomFlavor() {
                return Math.floor(Math.random() * 5);
            }

            function generatePlanks(count) {
                const planks = [];
                
                for (let i = 0; i < count; i++) {
                    const flavors = [];
                    
                    const pairFlavor = randomFlavor();
                    flavors.push(pairFlavor, pairFlavor);
                    
                    flavors.push(randomFlavor());
                    
                    for (let j = flavors.length - 1; j > 0; j--) {
                        const rand = Math.floor(Math.random() * (j + 1));
                        [flavors[j], flavors[rand]] = [flavors[rand], flavors[j]];
                    }
                    
                    const startCount = 1 + Math.floor(Math.random() * 2);
                    const current = flavors.slice(0, startCount);
                    
                    const futureCount = 2 + Math.floor(Math.random() * 2);
                    const future = [];
                    for (let f = 0; f < futureCount; f++) {
                        future.push(randomFlavor());
                    }
                    
                    planks.push({ current, future });
                }
                
                return planks;
            }

            function checkRewards() {
                const percent = (matches / goal) * 100;
                
                if (!rewardsCollected.reward1 && percent >= 33.33) {
                    rewardsCollected.reward1 = true;
                    balance += 100;
                    playerStats.totalCoinsEarned += 100;
                    reward1.classList.add('collected');
                }
                
                if (!rewardsCollected.reward2 && percent >= 66.66) {
                    rewardsCollected.reward2 = true;
                    balance += 150;
                    playerStats.totalCoinsEarned += 150;
                    reward2.classList.add('collected');
                }
                
                if (!rewardsCollected.reward3 && percent >= 100) {
                    rewardsCollected.reward3 = true;
                    balance += 200;
                    playerStats.totalCoinsEarned += 200;
                    reward3.classList.add('collected');
                }
                
                updateBalance();
                updateStats();
            }

            function refreshBoard() {
                if (!gameActive || refreshesLeft <= 0) return;
                
                refreshesLeft--;
                refreshCount.textContent = `${refreshesLeft}/${MAX_REFRESHES}`;
                
                const totalPlanks = planks.length;
                planks = generatePlanks(totalPlanks);
                
                renderBoard();
            }

            function getTimerColor(percent) {
                if (percent > 66) return '#2ecc71';
                if (percent > 33) return '#f39c12';
                return '#e74c3c';
            }

            function initGame(resetRefreshes = true) {
                stopTimer();
                
                if (matches > 0) {
                    playerStats.totalGames++;
                }
                
                matches = 0;
                firstMatchMade = false;
                
                rewardsCollected = {
                    reward1: false,
                    reward2: false,
                    reward3: false
                };
                reward1.classList.remove('collected', 'unavailable');
                reward2.classList.remove('collected', 'unavailable');
                reward3.classList.remove('collected', 'unavailable');
                
                if (resetRefreshes) {
                    refreshesLeft = MAX_REFRESHES;
                }
                refreshCount.textContent = `${refreshesLeft}/${MAX_REFRESHES}`;
                
                const config = difficultyConfig[currentDifficulty];
                const totalPlanks = 4 * config.rows;
                
                if (currentMode === 'timed') {
                    goal = config.goalTimed;
                    maxTime = 180.0;
                } else {
                    goal = config.goalSpeed;
                    maxTime = speedTimes[currentDifficulty];
                }
                
                currentTime = maxTime;
                gameActive = true;
                body.classList.remove('game-over');
                gameOverlay.classList.remove('show');
                victoryOverlay.classList.remove('show');
                
                planks = generatePlanks(totalPlanks);
                
                updateCounter();
                updateTimerDisplay();
                renderBoard();
                updateStats();
            }

            function startTimer() {
                if (timerInterval) return;
                
                timerInterval = setInterval(() => {
                    if (!gameActive) return;
                    
                    currentTime -= 0.1;
                    
                    if (currentTime <= 0) {
                        currentTime = 0;
                        gameActive = false;
                        stopTimer();
                        body.classList.add('game-over');
                        gameOverTitle.textContent = currentMode === 'timed' ? '–í—Ä–µ–º—è –≤—ã—à–ª–æ!' : '–°–ª–∏—à–∫–æ–º –º–µ–¥–ª–µ–Ω–Ω–æ!';
                        gameOverlay.classList.add('show');
                    }
                    
                    updateTimerDisplay();
                }, 100);
            }

            function stopTimer() {
                if (timerInterval) {
                    clearInterval(timerInterval);
                    timerInterval = null;
                }
            }

            function resetTimer() {
                if (currentMode === 'speed') {
                    currentTime = maxTime;
                }
                updateTimerDisplay();
            }

            function updateTimerDisplay() {
                const percent = (currentTime / maxTime) * 100;
                timerBar.style.width = `${percent}%`;
                timerBar.style.backgroundColor = getTimerColor(percent);
                
                if (currentMode === 'timed') {
                    const minutes = Math.floor(currentTime / 60);
                    const seconds = Math.floor(currentTime % 60);
                    timerDisplay.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                } else {
                    timerDisplay.textContent = `${currentTime.toFixed(1)}s`;
                }
            }

            function renderBoard() {
                const boardEl = document.getElementById('board');
                boardEl.innerHTML = '';

                planks.forEach((plank, plankIndex) => {
                    const container = document.createElement('div');
                    container.style.marginBottom = '15px';
                    container.style.display = 'flex';
                    container.style.flexDirection = 'column';
                    container.style.alignItems = 'center';

                    const plankDiv = document.createElement('div');
                    plankDiv.className = 'plank';
                    plankDiv.dataset.index = plankIndex;

                    const cakesArea = document.createElement('div');
                    cakesArea.className = 'cakes-area';

                    for (let pos = 0; pos < plank.current.length; pos++) {
                        const flavor = plank.current[pos];
                        const cake = document.createElement('div');
                        cake.className = 'cake';
                        cake.setAttribute('data-flavor', flavor);
                        cake.setAttribute('data-plank', plankIndex);
                        cake.setAttribute('data-position', pos);
                        cake.setAttribute('draggable', gameActive ? 'true' : 'false');

                        cake.addEventListener('dragstart', handleDragStart);
                        cake.addEventListener('dragend', handleDragEnd);
                        cake.addEventListener('dragover', (e) => e.preventDefault());
                        cake.addEventListener('drop', handleDropOnCake);

                        cakesArea.appendChild(cake);
                    }

                    plankDiv.appendChild(cakesArea);

                    const plateWrapper = document.createElement('div');
                    plateWrapper.className = 'plate-wrapper';

                    const plateArea = document.createElement('div');
                    plateArea.className = 'plate-area';

                    plank.future.forEach(flavor => {
                        const futureDiv = document.createElement('div');
                        futureDiv.className = 'future-cake';
                        futureDiv.setAttribute('data-flavor', flavor);
                        plateArea.appendChild(futureDiv);
                    });

                    plateWrapper.appendChild(plateArea);

                    container.appendChild(plankDiv);
                    container.appendChild(plateWrapper);

                    container.addEventListener('dragover', (e) => e.preventDefault());
                    container.addEventListener('drop', handleDropOnPlank);

                    boardEl.appendChild(container);
                });
            }

            function handleDragStart(e) {
                if (!gameActive) {
                    e.preventDefault();
                    return;
                }
                
                const cake = e.target.closest('.cake');
                if (!cake) return;

                sourcePlankIdx = parseInt(cake.dataset.plank, 10);
                sourceCakeIdx = parseInt(cake.dataset.position, 10);

                e.dataTransfer.setData('text/plain', JSON.stringify({
                    sourcePlank: sourcePlankIdx,
                    sourcePos: sourceCakeIdx
                }));

                cake.classList.add('dragging');
                draggedElement = cake;
            }

            function handleDragEnd(e) {
                if (draggedElement) {
                    draggedElement.classList.remove('dragging');
                }
                draggedElement = null;
                sourcePlankIdx = null;
                sourceCakeIdx = null;
            }

            function handleDropOnCake(e) {
                e.preventDefault();
                if (!gameActive) return;
                
                const targetCake = e.target.closest('.cake');
                if (!targetCake) return;

                const targetPlankIdx = targetCake.dataset.plank;
                if (targetPlankIdx === undefined) return;

                attemptMove(parseInt(targetPlankIdx, 10));
            }

            function handleDropOnPlank(e) {
                e.preventDefault();
                if (!gameActive) return;
                
                const container = e.target.closest('div[style*="margin-bottom"]');
                if (!container) return;

                const plankDiv = container.querySelector('.plank');
                if (!plankDiv) return;

                const targetPlankIdx = plankDiv.dataset.index;
                if (targetPlankIdx === undefined) return;

                attemptMove(parseInt(targetPlankIdx, 10));
            }

            function attemptMove(targetPlankIdx) {
                if (!gameActive) return;
                if (sourcePlankIdx === null || sourceCakeIdx === null) {
                    clearDrag();
                    return;
                }

                if (sourcePlankIdx === targetPlankIdx) {
                    clearDrag();
                    return;
                }

                const sourcePlank = planks[sourcePlankIdx];
                const targetPlank = planks[targetPlankIdx];

                if (sourceCakeIdx >= sourcePlank.current.length) {
                    clearDrag();
                    return;
                }

                if (targetPlank.current.length >= MAX_CAKES) {
                    clearDrag();
                    return;
                }

                const flavor = sourcePlank.current[sourceCakeIdx];

                sourcePlank.current.splice(sourceCakeIdx, 1);
                targetPlank.current.push(flavor);

                renderBoard();
                checkMatches();
                clearDrag();
            }

            function checkMatches() {
                if (!gameActive) return;
                
                let matchPlanks = [];

                for (let i = 0; i < planks.length; i++) {
                    const plank = planks[i];
                    
                    if (plank.current.length === 3) {
                        const [a, b, c] = plank.current;
                        if (a === b && b === c) {
                            matchPlanks.push(i);
                        }
                    }
                }

                if (matchPlanks.length > 0) {
                    if (!firstMatchMade) {
                        firstMatchMade = true;
                        startTimer();
                    }
                    
                    animateMatches(matchPlanks);
                }
            }

            function animateMatches(matchPlanks) {
                const cakes = document.querySelectorAll('.cake');
                
                cakes.forEach(cake => {
                    const plankIdx = parseInt(cake.dataset.plank, 10);
                    if (matchPlanks.includes(plankIdx)) {
                        cake.classList.add('matched');
                    }
                });

                setTimeout(() => {
                    matchPlanks.forEach(plankIndex => {
                        matches++;
                        playerStats.totalMatches++;
                        
                        if (matches > playerStats.bestScore) {
                            playerStats.bestScore = matches;
                        }
                        
                        const plank = planks[plankIndex];
                        const futureCopy = [...plank.future];
                        
                        plank.current = [];
                        
                        for (let f = 0; f < Math.min(futureCopy.length, MAX_CAKES); f++) {
                            plank.current.push(futureCopy[f]);
                        }
                        
                        const newFutureCount = futureCopy.length;
                        plank.future = [];
                        for (let n = 0; n < newFutureCount; n++) {
                            plank.future.push(randomFlavor());
                        }
                    });

                    if (currentMode === 'speed') {
                        resetTimer();
                    }
                    
                    updateCounter();
                    checkRewards();
                    renderBoard();

                    if (matches >= goal) {
                        gameActive = false;
                        stopTimer();
                        playerStats.totalWins++;
                        victoryOverlay.classList.add('show');
                    } else {
                        checkMatches();
                    }
                    
                    updateStats();
                    saveToStorage();
                }, 500);
            }

            function updateCounter() {
                matchesCount.textContent = matches;
                goalCount.textContent = goal;
                const percent = (matches / goal) * 100;
                goalProgress.style.width = `${percent}%`;
            }

            function clearDrag() {
                if (draggedElement) {
                    draggedElement.classList.remove('dragging');
                }
                draggedElement = null;
                sourcePlankIdx = null;
                sourceCakeIdx = null;
            }

            // ========== –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò ==========
            
            document.querySelectorAll('.profile-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    document.querySelectorAll('.profile-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    
                    saveToStorage();
                    currentProfile = btn.dataset.profile;
                    loadFromStorage();
                    initGame(true);
                });
            });
            
            document.getElementById('saveGameBtn').addEventListener('click', saveToStorage);
            document.getElementById('exportGameBtn').addEventListener('click', exportGame);
            document.getElementById('importGameBtn').addEventListener('click', () => {
                importData.value = '';
                importModal.classList.add('show');
            });
            
            document.getElementById('copyExportBtn').addEventListener('click', () => {
                exportData.select();
                document.execCommand('copy');
                setTimeout(() => exportModal.classList.remove('show'), 500);
            });
            
            document.getElementById('closeExportBtn').addEventListener('click', () => {
                exportModal.classList.remove('show');
            });
            
            document.getElementById('closeImportBtn').addEventListener('click', () => {
                importModal.classList.remove('show');
            });
            
            document.getElementById('confirmImportBtn').addEventListener('click', () => {
                if (importData.value.trim()) {
                    importGame(importData.value.trim());
                }
            });
            
            document.querySelectorAll('.mode-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentMode = btn.dataset.mode;
                    initGame(true);
                });
            });

            document.querySelectorAll('.difficulty-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    document.querySelectorAll('.difficulty-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentDifficulty = btn.dataset.difficulty;
                    initGame(true);
                });
            });

            refreshBtn.addEventListener('click', refreshBoard);

            document.getElementById('restartFromOverlay').addEventListener('click', () => initGame(true));
            document.getElementById('restartFromVictory').addEventListener('click', () => initGame(true));

            document.addEventListener('dragover', (e) => e.preventDefault());
            document.addEventListener('drop', (e) => e.preventDefault());

            loadFromStorage();
            initGame(true);
        }

        // –ó–∞–ø—É—Å–∫–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É —Ç–µ–∫—Å—Ç—É—Ä
        loadTextures();
    </script>
</body>
</html>