<!doctype html>

<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title><3</title>
<style>
html,body{
  margin:0;
  height:100%;
  background:#000;
  overflow:hidden;
  font-family:Arial,sans-serif;
  color:#fff;
}
.wrap{
  width:100vw;
  height:100vh;
  overflow:hidden;
  position:relative;
  background:#000;
}
.track{
  display:flex;
  height:100%;
  transition:transform .35s ease;
  will-change:transform;
  touch-action: none;
}
.slide{
  min-width:100vw;
  display:flex;
  justify-content:center;
  align-items:center;
  position:relative;
  overflow:hidden;
  background:#000;
}
.slide img{
  max-width:100%;
  max-height:100%;
  object-fit:contain;
  user-select:none;
  pointer-events:none;
  display:block;
}
@media screen and (min-width:769px){
  .slide img{
    max-width:66.66%;
    max-height:66.66%;
  }
}
@media screen and (max-width:768px) and (orientation:portrait){
  .slide img{
    width:100vw;
    height:auto;
    object-fit:cover;
  }
}
.dots{
  position:absolute;
  left:50%;
  transform:translateX(-50%);
  display:flex;
  gap:10px;
}
.dot{
  width:10px;
  height:10px;
  background:#444;
  border-radius:50%;
  transition:.25s;
}
.dot.active{
  background:#fff;
  transform:scale(1.2);
}
.counter{
  position:absolute;
  padding:6px 10px;
  font-size:16px;
  background:rgba(255,255,255,0.12);
  border-radius:6px;
}
.zoomLayer{
  position:absolute;
  top:0; left:0;
  width:100vw;
  height:100vh;
  background:#000;
  display:flex;
  justify-content:center;
  align-items:center;
  z-index:1000;
  touch-action:none;
  display:none;
}
.zoomLayer img{
  max-width:100vw;
  max-height:100vh;
  transform-origin:center center;
  transition: transform 0.05s linear;
}
</style>
</head>
<body>

<div class="wrap">
  <div id="track" class="track"></div>
  <div id="dots" class="dots"></div>
  <div id="counter" class="counter"></div>
  <div id="zoomLayer" class="zoomLayer"><img id="zoomImg"></div>
</div>

<script>
if (localStorage.getItem("auth") !== "true") {
      window.location.href = "/login/index.html";
}
const EXTS=["png","jpg","jpeg","webp"];

// --- Загрузка всех изображений ---
async function exists(url){
  return new Promise(res=>{
    const i=new Image();
    i.onload=()=>res(true);
    i.onerror=()=>res(false);
    i.src=url;
  });
}
async function getAllImages(){
  let arr=[];
  for(let n=1;n<9999;n++){
    let found=null;
    for(let e of EXTS){
      const u=`images/${n}.${e}`;
      if(await exists(u)){ found=u; break; }
    }
    if(!found) break;
    arr.push(found);
  }
  return arr;
}

let images = [];
let slides = [];
let current = 0;
const track = document.getElementById("track");
const dots = document.getElementById("dots");
const counter = document.getElementById("counter");

// --- Показать загрузку ---
track.innerHTML="<div style='color:#777;font-size:20px'>Секундочку, загрузка!</div>";

function createSlide(src){
  const div=document.createElement("div");
  div.className="slide";
  const img=document.createElement("img");
  img.src=src;
  div.appendChild(img);
  return div;
}
function render(){
  track.innerHTML="";
  dots.innerHTML="";
  slides=[];
  images.forEach((src,i)=>{
    const slide=createSlide(src);
    track.appendChild(slide);
    slides[i]=slide;
    const d=document.createElement("div");
    d.className="dot";
    dots.appendChild(d);
  });
  update();
}

function update(){
  track.style.transform=`translateX(${-current*window.innerWidth}px)`;
  [...dots.children].forEach((d,i)=>d.classList.toggle("active",i===current));
  counter.textContent=`${current+1} / ${images.length}`;
  updateDotsAndCounterPosition();
}
function updateDotsAndCounterPosition(){
  if(slides.length===0) return;
  const img = slides[current].querySelector("img");
  if(!img) return;
  const imgRect = img.getBoundingClientRect();
  const wrapRect = document.querySelector(".wrap").getBoundingClientRect();
  const bottomY = wrapRect.top + wrapRect.height/2 + imgRect.height/2;
  dots.style.top = (bottomY + 10) + "px";
  dots.style.left = "50%";
  dots.style.transform = "translateX(-50%)";
  const leftEdge = wrapRect.left + (wrapRect.width-imgRect.width)/2 + 5;
  counter.style.top = (bottomY + 10) + "px";
  counter.style.left = leftEdge + "px";
  counter.style.transform = "none";
}

// --- Свайп ---
let drag=false, startX=0, baseX=0;
track.addEventListener("pointerdown", e=>{
  if(e.pointerType==="touch" && e.isPrimary===false) return; // игнор второе касание
  drag=true;
  startX=e.clientX;
  baseX=-current*window.innerWidth;
  track.style.transition="none";
});
window.addEventListener("pointermove", e=>{
  if(!drag) return;
  const dx=e.clientX-startX;
  track.style.transform=`translateX(${baseX+dx}px)`;
});
window.addEventListener("pointerup", e=>{
  if(!drag) return;
  drag=false;
  track.style.transition="transform .35s ease";
  const dx=e.clientX-startX;
  const tr=window.innerWidth*0.15;
  if(dx<-tr && current<images.length-1) current++;
  else if(dx>tr && current>0) current--;
  update();
});

// --- Zoom двумя пальцами ---
const zoomLayer=document.getElementById("zoomLayer");
const zoomImg=document.getElementById("zoomImg");
let startDist=0, scale=1;

track.addEventListener("pointerdown", e=>{
  if(e.pointerType!=="touch") return;
  const target=e.target;
  if(target.tagName!=="IMG") return;
  const touches=[...e.targetTouches || []];
  if(touches.length<2) return; // только при двух пальцах
  e.preventDefault();
  zoomImg.src=target.src;
  scale=1;
  zoomImg.style.transform="scale(1)";
  zoomLayer.style.display="flex";
});

zoomLayer.addEventListener("touchmove", e=>{
  if(e.touches.length<2) return;
  const dx=e.touches[0].clientX-e.touches[1].clientX;
  const dy=e.touches[0].clientY-e.touches[1].clientY;
  const dist=Math.sqrt(dx*dx+dy*dy);
  if(startDist===0) startDist=dist;
  scale=dist/startDist;
  zoomImg.style.transform=`scale(${scale})`;
});

zoomLayer.addEventListener("touchend", e=>{
  startDist=0;
  zoomLayer.style.display="none";
});
zoomLayer.addEventListener("touchcancel", e=>{
  startDist=0;
  zoomLayer.style.display="none";
});

// --- Стрелки ПК ---
window.addEventListener("keydown", e=>{
  if(e.key==="ArrowRight" && current<images.length-1) current++;
  if(e.key==="ArrowLeft" && current>0) current--;
  update();
});

// --- Инициализация ---
(async()=>{
  images = await getAllImages();
  if(images.length===0){
    track.innerHTML="<div style='color:#777;font-size:20px'>Нет изображений</div>";
    return;
  }
  render();
})();
</script>

</body>
</html>


